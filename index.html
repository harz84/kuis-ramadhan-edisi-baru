<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kuis Ngabuburit Ramadhan 1447 H</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        
        html, body { 
            height: 100%; margin: 0; padding: 0; 
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        /* --- BACKGROUND & PERBAIKAN LAYAR HP --- */
        body {
            display: flex; justify-content: center; align-items: flex-start; 
            min-height: 100vh;
            padding: 80px 15px 40px 15px; /* Menambah ruang atas agar tidak tertutup timer melayang */
            background: linear-gradient(-45deg, #0f3e33, #155d4c, #0a2e3f, #1f2b38);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #ffffff;
            overflow-y: auto; 
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- GLASSMORPHISM GAME AREA --- */
        #gameArea {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px; 
            padding: 40px 20px 60px 20px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); 
            text-align: center; 
            max-width: 800px; 
            width: 100%; 
            position: relative;
            margin: auto; 
        }

        /* --- TIMER MELAYANG (FLOATING) --- */
        #timerContainer { 
            position: fixed; /* Membuatnya selalu menempel di layar */
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%); /* Menempatkannya tepat di tengah */
            z-index: 1200; /* Selalu di lapisan paling atas */
            display: none; 
            justify-content: center; 
            align-items: center; 
            background: rgba(0, 0, 0, 0.75); /* Sedikit gelap agar kontras dengan soal */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        #timerIcon { width: 28px; height: 28px; margin-right: 10px; filter: brightness(0) invert(1); }
        #timer { font-size: 28px; font-weight: 700; color: #fff; letter-spacing: 2px; margin: 0; line-height: 1; }
        
        .pulse-danger { animation: pulseRed 1s infinite; color: #ff6b6b !important; }
        @keyframes pulseRed { 0% { transform: scale(1); } 50% { transform: scale(1.1); text-shadow: 0 0 10px red; } 100% { transform: scale(1); } }

        /* --- TYPOGRAPHY --- */
        #judulGame { 
            font-size: 36px; color: #F5D061; margin-bottom: 15px; font-weight: 700; 
            text-shadow: 2px 2px 8px rgba(0,0,0,0.4); 
            line-height: 1.3;
        }
        #petunjuk { font-size: 18px; margin-bottom: 25px; line-height: 1.6; font-weight: 400; color: #eef; }

        /* --- ANIMASI TRANSISI SOAL --- */
        .fade-in-up { animation: fadeInUp 0.6s ease forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- TOMBOL PILIHAN GANDA (MODERN) --- */
        #pilihanGanda { display: flex; flex-direction: column; gap: 12px; margin-bottom: 10px; }
        #pilihanGanda button {
            font-family: 'Poppins', sans-serif; 
            font-size: 15px; 
            padding: 15px 20px; 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 12px; 
            background: rgba(255, 255, 255, 0.85); 
            color: #1a2a26; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-align: left; 
            line-height: 1.4;
            font-weight: 600;
        }
        #pilihanGanda button:hover { 
            background: #ffffff; 
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); 
        }
        #pilihanGanda button.salah { background-color: #ff6b6b !important; color: white; animation: shake 0.5s; border: none; }
        #pilihanGanda button.benar { background-color: #51cf66 !important; color: white; border: none; }

        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* --- INPUT & TOMBOL MULAI --- */
        #namaPeserta {
            padding: 15px; margin-bottom: 25px; font-size: 16px; border-radius: 12px; 
            border: 2px solid transparent; width: 85%; max-width: 320px; text-align: center;
            background: rgba(255,255,255,0.9); font-family: 'Poppins', sans-serif;
            outline: none; transition: 0.3s;
        }
        #namaPeserta:focus { border: 2px solid #F5D061; box-shadow: 0 0 15px rgba(245, 208, 97, 0.5); background: #ffffff; }
        
        #startButton { 
            font-size: 18px; padding: 14px 35px; border: none; border-radius: 50px; 
            background: linear-gradient(135deg, #F5D061, #e6b12c); color: #1a2a26; 
            cursor: pointer; font-weight: bold; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 208, 97, 0.4); text-transform: uppercase; letter-spacing: 1px;
        }
        #startButton:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(245, 208, 97, 0.6); }

        /* TEKS BISMILLAH DIPERBESAR */
        #bismillah { font-size: 40px; color: rgba(255,255,255,0.8); margin-top: 15px; font-style: normal; font-weight: normal;}
        
        #hasil { font-size: 22px; margin-top: 15px; font-weight: bold; min-height: 33px; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        
        #skor { position: absolute; bottom: 20px; right: 0; left: 0; font-size: 16px; font-weight: bold; color: rgba(255,255,255,0.8); text-align: center;}
        #skorBenar { color: #51cf66; }
        #skorSalah { color: #ff6b6b; }

        #copyright { position: fixed; bottom: 10px; right: 15px; font-size: 12px; color: rgba(255,255,255,0.5); z-index: 1100; }

        /* POSISI ANIMASI DI SAMPING KANAN TEKS JUDUL SOAL */
        #correctAnimation, #wrongAnimation { 
            position: absolute; 
            left: 100%; 
            top: 50%; 
            transform: translateY(-50%); 
            margin-left: 12px; 
            width: 50px; 
            height: 50px; 
            display: none; 
            z-index: 1050; 
            pointer-events: none; 
        }

        /* RESPONSIVE UNTUK HP */
        @media (max-width: 768px) {
            body { padding: 70px 10px 20px 10px; } /* Jarak atas ditambah agar timer tidak menutupi kuis */
            #judulGame { font-size: 26px; }
            #petunjuk { font-size: 15px; }
            #pilihanGanda button { font-size: 14px; padding: 12px 15px; }
            #gameArea { padding: 30px 15px 50px 15px; }
            #correctAnimation, #wrongAnimation { width: 45px; height: 45px; margin-left: 8px; }
            
            /* Penyesuaian Timer untuk HP */
            #timerContainer { top: 10px; padding: 6px 15px; }
            #timer { font-size: 22px; }
            #timerIcon { width: 20px; height: 20px; }
        }
    </style>
</head>
<body>
    <div id="timerContainer" style="display: none;">
        <img id="timerIcon" src="https://img.icons8.com/ios-filled/50/ffffff/hourglass.png" alt="Hourglass">
        <span id="timer">07:00</span>
    </div>

    <div id="gameArea">
        <div id="startScreen" class="fade-in-up">
            <h1 id="judulGame">Kuis Ngabuburit<br>Ramadhan 1447 H</h1>
            <p id="petunjuk" style="font-size: 16px;">Uji pengetahuan Islam kamu sambil menunggu waktu berbuka puasa!</p>
            
            <input type="text" id="namaPeserta" placeholder="Ketik Nama Anda Di Sini"><br>
            <button id="startButton">Mulai Kuis</button>
            <p id="bismillah">Ô∑Ω</p>
        </div>

        <div id="judulSoalWrapper" class="fade-in-up" style="display: none; text-align: center; margin-bottom: 15px;">
            <div style="display: inline-flex; align-items: center; position: relative;">
                <h1 id="judulGameAktif" style="font-size: 20px; color: #F5D061; margin: 0;"></h1>
                <div id="correctAnimation"></div>
                <div id="wrongAnimation"></div>
            </div>
        </div>

        <p id="petunjukSoal" class="fade-in-up" style="display: none;"></p>
        
        <div id="pilihanGanda" class="fade-in-up" style="display: none;">
            </div>
        
        <p id="hasil"></p>
        
        <div id="skor" style="display: none;">
            ‚úÖ Benar: <span id="skorBenar">0</span> &nbsp;|&nbsp; ‚ùå Salah: <span id="skorSalah">0</span>
        </div>
    </div>
    
    <div id="copyright">¬© Mas Har 2026</div>

    <script>
        // --- SOAL TERBARU ---
        const dataTebakan = [
            { 
                deskripsi: "Nabi Ibrahim 'alaihissalam dikenal dengan gelar \"Khalilullah\" (Kekasih Allah). Beliau pernah berhadapan dengan seorang raja zalim yang mengaku sebagai tuhan dan mendebatnya tentang siapa yang menerbitkan matahari. Siapakah nama raja tersebut?", 
                jawaban: "Namrud", 
                pilihan: ["Fir'aun", "Namrud", "Abrahah", "Jalut"] 
            },
            { 
                deskripsi: "Allah Subhanahu wa Ta'ala memberikan beberapa mukjizat kepada Nabi Musa 'alaihissalam untuk menghadapi Fir'aun. Salah satu mukjizat tersebut adalah tangannya dapat mengeluarkan cahaya putih. Apa mukjizat besar lainnya yang menyertai hal tersebut pada awal kenabiannya?", 
                jawaban: "Tongkat kayu yang dapat berubah menjadi ular besar yang hidup", 
                pilihan: ["Mampu menyembuhkan orang buta sejak lahir dengan usapan tangannya", "Tongkat kayu yang dapat berubah menjadi ular besar yang hidup", "Mampu menghidupkan kembali burung yang sudah dipotong-potong", "Diberikan kemampuan memahami bahasa semut dan burung"] 
            },
            { 
                deskripsi: "Nabi Nuh 'alaihissalam berdakwah kepada kaumnya tanpa kenal lelah, namun hanya sedikit sekali yang mau beriman. Berapa lamakah masa dakwah Nabi Nuh kepada kaumnya sebagaimana disebutkan secara jelas dalam Al-Qur'an?", 
                jawaban: "950 tahun", 
                pilihan: ["500 tahun", "950 tahun", "1000 tahun", "300 tahun"] 
            },
            { 
                deskripsi: "Nabi Yunus 'alaihissalam meninggalkan kaumnya dalam keadaan marah karena mereka enggan beriman. Beliau kemudian ditelan oleh ikan besar. Doa apakah yang terus menerus beliau panjatkan saat berada di dalam tiga kegelapan perut ikan tersebut?", 
                jawaban: "Laa ilaaha illaa anta subhaanaka innii kuntu minadz dzoolimiin", 
                pilihan: ["Hasbunallah wa ni'mal wakiil, ni'mal mawla wa ni'man nashiir", "Laa ilaaha illaa anta subhaanaka innii kuntu minadz dzoolimiin", "Rabbanaa aatinaa fid dunyaa hasanah wa fil aakhirati hasanah", "Rabbi inni lima anzalta ilayya min khairin faqir"] 
            },
            { 
                deskripsi: "Nabi Yusuf 'alaihissalam dibuang ke dalam sumur oleh saudara-saudaranya karena rasa hasad (iri dengki). Setelah ditemukan oleh rombongan musafir, kemanakah akhirnya Nabi Yusuf dibawa dan dijual sebagai budak?", 
                jawaban: "Negeri Mesir", 
                pilihan: ["Negeri Syam (Palestina)", "Negeri Madyan", "Negeri Mesir", "Negeri Yaman"] 
            },
            { 
                deskripsi: "Zakat yang wajib dikeluarkan oleh setiap jiwa muslim (laki-laki, perempuan, dewasa, anak-anak, merdeka, atau hamba sahaya) pada akhir bulan Ramadhan sebelum shalat Id disebut dengan?", 
                jawaban: "Zakat Fitrah", 
                pilihan: ["Zakat Maal", "Zakat Fitrah", "Zakat Profesi", "Zakat Rikaz"] 
            },
            { 
                deskripsi: "Berapakah takaran baku zakat fitrah yang diwajibkan oleh Rasulullah Ô∑∫ untuk dikeluarkan berupa makanan pokok (seperti beras, gandum, atau kurma)?", 
                jawaban: "Satu Sha' (sekitar 2,5 hingga 3 kilogram)", 
                pilihan: ["Satu Sha' (sekitar 2,5 hingga 3 kilogram)", "Setengah Sha' (sekitar 1,25 hingga 1,5 kilogram)", "Dua Mud (sekitar 1,5 liter)", "Bebas sesuai dengan kerelaan dan kemampuan masing-masing individu"] 
            },
            { 
                deskripsi: "Seseorang memiliki emas batangan yang disimpan. Berapakah batas minimal berat emas (nisab) tersebut agar ia wajib mengeluarkan zakat maal jika hartanya sudah mengendap satu tahun (haul)?", 
                jawaban: "20 Dinar atau sekitar 85 gram emas murni", 
                pilihan: ["20 Dinar atau sekitar 85 gram emas murni", "200 Dirham atau sekitar 595 gram perak murni", "100 gram emas murni", "50 gram emas murni"] 
            },
            { 
                deskripsi: "Di dalam Al-Qur'an Surah At-Taubah ayat 60, Allah menyebutkan ada 8 golongan yang berhak menerima zakat (mustahik). Siapakah yang dimaksud dengan golongan \"Gharimin\"?", 
                jawaban: "Orang yang memiliki hutang (untuk ketaatan atau kebutuhan mubah) dan tidak mampu melunasinya", 
                pilihan: ["Orang yang baru memeluk agama Islam dan imannya masih lemah", "Orang yang sedang dalam perjalanan jauh (musafir) dan kehabisan bekal", "Orang yang memiliki hutang (untuk ketaatan atau kebutuhan mubah) dan tidak mampu melunasinya", "Orang yang ditugaskan oleh pemerintah Islam untuk mengumpulkan dan membagikan zakat"] 
            },
            { 
                deskripsi: "Seorang petani memanen hasil sawahnya yang selama ini diairi menggunakan air hujan dan air sungai (tanpa ada biaya tambahan untuk pengairan). Berapa persentase zakat pertanian yang wajib ia keluarkan jika hasil panennya telah mencapai nisab?", 
                jawaban: "10% (Sepersepuluh)", 
                pilihan: ["2,5% (Seperempat puluh)", "5% (Seperdua puluh)", "10% (Sepersepuluh)", "20% (Seperlima)"] 
            },
            { 
                deskripsi: "Manakah di antara amalan berikut yang merupakan sunnah Nabi Ô∑∫ sebelum berangkat dari rumah untuk melaksanakan shalat Idul Fitri?", 
                jawaban: "Memakan beberapa butir kurma dalam jumlah ganjil sebelum berangkat ke tempat shalat", 
                pilihan: ["Menahan diri dari makan dan minum hingga selesai shalat Idul Fitri untuk menyantap hidangan kurban", "Memakan beberapa butir kurma dalam jumlah ganjil sebelum berangkat ke tempat shalat", "Melaksanakan puasa sunnah satu hari penuh pada hari Idul Fitri sebagai penutup Ramadhan", "Shalat sunnah qabliyah dua rakaat di rumah sebelum berangkat ke lapangan atau masjid"] 
            },
            { 
                deskripsi: "Berapakah jumlah takbir tambahan (takbir zawaid) pada rakaat pertama dan kedua dalam shalat Idul Fitri (selain takbiratul ihram dan takbir intiqal) menurut sunnah yang rajih?", 
                jawaban: "Tujuh kali di rakaat pertama dan lima kali di rakaat kedua", 
                pilihan: ["Lima kali di rakaat pertama dan lima kali di rakaat kedua", "Tujuh kali di rakaat pertama dan lima kali di rakaat kedua", "Tiga kali di rakaat pertama dan tiga kali di rakaat kedua sebelum ruku'", "Enam kali di rakaat pertama dan lima kali di rakaat kedua"] 
            },
            { 
                deskripsi: "Salah satu sunnah saat berangkat menuju dan pulang dari tempat pelaksanaan shalat Idul Fitri adalah:", 
                jawaban: "Mengambil rute jalan yang berbeda antara saat berangkat menuju tempat shalat dan saat pulang", 
                pilihan: ["Berjalan kaki dengan cepat agar segera sampai di tujuan dan mendapatkan shaf terdepan", "Menggunakan kendaraan yang paling mewah sebagai bentuk rasa syukur atas nikmat Allah", "Melewati rute jalan yang sama persis saat berangkat maupun saat pulang dari tempat shalat", "Mengambil rute jalan yang berbeda antara saat berangkat menuju tempat shalat dan saat pulang"] 
            },
            { 
                deskripsi: "Di manakah tempat yang paling utama (afdhal) untuk melaksanakan shalat Idul Fitri sesuai dengan petunjuk (sunnah) Rasulullah Ô∑∫, jika cuaca dalam keadaan cerah dan memungkinkan?", 
                jawaban: "Di tanah lapang (mushalla) yang luas yang berada di luar atau area terbuka", 
                pilihan: ["Di dalam masjid Jami' terbesar di kota tersebut agar semua jamaah bisa berkumpul", "Di tanah lapang (mushalla) yang luas yang berada di luar atau area terbuka", "Di rumah masing-masing bersama anggota keluarga secara berjamaah", "Di pelataran dalam masjid agar terhindar dari panas matahari pagi"] 
            },
            { 
                deskripsi: "Bagaimana ketentuan pelaksanaan khutbah pada shalat Idul Fitri jika dibandingkan dengan khutbah pada shalat Jumat?", 
                jawaban: "Khutbah Idul Fitri dilaksanakan sesudah shalat, sedangkan khutbah Jumat dilaksanakan sebelum shalat", 
                pilihan: ["Khutbah Idul Fitri dilaksanakan sebelum shalat, sedangkan khutbah Jumat sesudah shalat", "Keduanya dilaksanakan sebelum pelaksanaan shalat agar jamaah tidak pulang terlebih dahulu", "Khutbah Idul Fitri dilaksanakan sesudah shalat, sedangkan khutbah Jumat dilaksanakan sebelum shalat", "Jamaah diwajibkan untuk tetap duduk mendengarkan khutbah Idul Fitri sebagaimana wajibnya pada shalat Jumat"] 
            }
        ];

        // --- Variabel Global ---
        let soalSaatIni; let jawabanBenar = false; let skorBenar = 0; let skorSalah = 0; 
        let soalSudahDitampilkan = new Set(); let nomorSoal = 0; const totalSoal = 15; 
        let timerInterval = null; let timeLeft = 720; // 7 menit
        let isGameOverSoundPlayed = false; let namaUser = "";

        // --- Audio Sederhana ---
        function playSound(type) {
            let src = '';
            if(type === 'start') src = 'ping.wav';
            else if(type === 'success') src = 'success.wav';
            else if(type === 'fail') src = 'gameovertwew.wav';
            else src = type; 
            
            if(src) {
                let audio = new Audio(src);
                audio.play().catch(e => console.log("Audio play prevented:", e));
            }
        }

        function updateTimer() { 
            let minutes = Math.floor(timeLeft / 60); 
            let seconds = timeLeft % 60; 
            const timerEl = document.getElementById("timer");
            timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; 
            
            if(timeLeft <= 30) timerEl.classList.add("pulse-danger");
            else timerEl.classList.remove("pulse-danger");

            if (timeLeft <= 0) { 
                clearInterval(timerInterval); timerInterval = null; 
                if (nomorSoal < totalSoal) { skorSalah += (totalSoal - nomorSoal); } 
                akhirPermainan(); 
            } else { 
                timeLeft--; 
            } 
        }

        function triggerAnimation(elementId) {
            const el = document.getElementById(elementId);
            el.classList.remove("fade-in-up");
            void el.offsetWidth; // trigger reflow
            el.classList.add("fade-in-up");
        }

        function playLottieAnimation(type) { 
            const container = document.getElementById(type === 'correct' ? 'correctAnimation' : 'wrongAnimation');
            container.style.display = 'block'; container.innerHTML = ''; 
            try { 
                lottie.loadAnimation({ container: container, renderer: 'svg', loop: false, autoplay: true, path: type === 'correct' ? 'correctan.json' : 'wrong.json' }); 
            } catch (e) {} 
            setTimeout(() => { container.style.display = 'none'; }, 2000); 
        }

        function mulaiPermainan() {
            document.getElementById("startScreen").style.display = "none";
            document.getElementById("timerContainer").style.display = "flex"; // Timer dimunculkan dengan flex
            
            const judulSoalWrapper = document.getElementById("judulSoalWrapper");
            const judulGameAktif = document.getElementById("judulGameAktif");
            const petunjukSoal = document.getElementById("petunjukSoal");
            const pilihanGanda = document.getElementById("pilihanGanda");
            
            judulSoalWrapper.style.display = "block";
            petunjukSoal.style.display = "block";
            pilihanGanda.style.display = "flex";
            document.getElementById("skor").style.display = "block";

            if (!timerInterval && timeLeft > 0) { updateTimer(); timerInterval = setInterval(updateTimer, 1000); }

            jawabanBenar = false;
            let soalTersedia = dataTebakan.filter(soal => !soalSudahDitampilkan.has(soal.deskripsi));

            if (soalTersedia.length === 0 || nomorSoal >= totalSoal) { 
                akhirPermainan(); return; 
            }

            nomorSoal++;
            soalSaatIni = soalTersedia[Math.floor(Math.random() * soalTersedia.length)];
            soalSudahDitampilkan.add(soalSaatIni.deskripsi);

            judulGameAktif.textContent = `Soal ${nomorSoal} dari ${totalSoal}`;
            petunjukSoal.textContent = soalSaatIni.deskripsi;
            
            triggerAnimation("judulSoalWrapper");
            triggerAnimation("petunjukSoal");
            triggerAnimation("pilihanGanda");

            pilihanGanda.innerHTML = '';
            const shuffledPilihan = [...soalSaatIni.pilihan].sort(() => Math.random() - 0.5);

            shuffledPilihan.forEach(pilihanText => {
                const button = document.createElement("button"); 
                button.textContent = pilihanText;
                button.onclick = function() { 
                    if (!jawabanBenar && timeLeft > 0) cekJawaban(pilihanText, button); 
                };
                pilihanGanda.appendChild(button);
            });

            document.getElementById("hasil").textContent = ""; 
            document.getElementById("skorBenar").textContent = skorBenar; 
            document.getElementById("skorSalah").textContent = skorSalah;
        }

        function cekJawaban(jawabanYangDipilih, buttonElement) {
            const pilihanButtons = document.querySelectorAll("#pilihanGanda button"); 
            pilihanButtons.forEach(btn => btn.style.pointerEvents = 'none'); 
            
            if (jawabanYangDipilih === soalSaatIni.jawaban) {
                document.getElementById("hasil").textContent = "‚ú® Jawaban Benar!"; 
                document.getElementById("hasil").style.color = "#51cf66";
                playLottieAnimation('correct'); playSound('success'); 
                jawabanBenar = true; skorBenar++;
                buttonElement.classList.add("benar");
            } else {
                document.getElementById("hasil").textContent = "‚ùå Jawaban Salah!"; 
                document.getElementById("hasil").style.color = "#ff6b6b";
                playLottieAnimation('wrong'); playSound('fail'); 
                skorSalah++;
                buttonElement.classList.add("salah");
                
                pilihanButtons.forEach(btn => { 
                    if (btn.textContent === soalSaatIni.jawaban) btn.classList.add("benar"); 
                });
            }
            
            document.getElementById("skorBenar").textContent = skorBenar;
            document.getElementById("skorSalah").textContent = skorSalah;

            setTimeout(() => { 
                if (nomorSoal < totalSoal && timeLeft > 0) mulaiPermainan(); 
                else akhirPermainan(); 
            }, 2000);
        }

        function akhirPermainan() {
            if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
            if (isGameOverSoundPlayed) return;

            const skorAkhir = totalSoal > 0 ? (skorBenar / totalSoal) * 100 : 0;
            let warnaSkor, komentar, gameOverSoundFile;

            if (skorAkhir < 50) { gameOverSoundFile = 'ast.mp3'; komentar = "Belajar lagi ya.... üòäüìö"; warnaSkor = "#ff6b6b"; }
            else if (skorAkhir <= 84) { gameOverSoundFile = 'alh.mp3'; komentar = "Alhamdulillah, Mantap! üëç"; warnaSkor = "#F5D061"; }
            else { gameOverSoundFile = 'masy.mp3'; komentar = "MasyaAllah, Kamu Luar Biasa! üåüüèÜ"; warnaSkor = "#51cf66"; }

            document.getElementById("judulGameAktif").textContent = "Kuis Selesai!";
            document.getElementById("timerContainer").style.display = "none";
            document.getElementById("skor").style.display = "none";
            document.getElementById("pilihanGanda").style.display = "none";
            document.getElementById("hasil").style.display = "none";

            const petunjuk = document.getElementById("petunjukSoal");
            petunjuk.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 15px;">Alhamdulillah, Terima kasih <b>${namaUser}</b>!</div>
                <div style="font-size: 40px; font-weight: bold; color: ${warnaSkor}; text-shadow: 0 0 10px rgba(0,0,0,0.5); margin: 20px 0;">Nilai: ${skorAkhir.toFixed(0)}</div>
                <div style="font-size: 18px; display: inline-block; text-align: left; background: rgba(0,0,0,0.2); padding: 15px 30px; border-radius: 15px;">
                    ‚úÖ Benar: <b>${skorBenar}</b><br>
                    ‚ùå Salah: <b>${skorSalah}</b>
                </div>
                <div style="margin-top: 20px; font-size: 22px; color: #fff;">${komentar}</div>
            `;
            triggerAnimation("judulSoalWrapper");
            triggerAnimation("petunjukSoal");

            playSound(gameOverSoundFile); isGameOverSoundPlayed = true;

            // --- PENGIRIMAN DATA KE GOOGLE SHEETS ---
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzcZ-6282s8art10zsRbaadJsa-VDQ_HsXtfHIJFmAH-iav481nDn40hFWU_baiJUVREQ/exec'; 
            
            let dataKuis = { waktu: new Date().toLocaleString('id-ID'), nama: namaUser, skor: skorAkhir.toFixed(0), benar: skorBenar, salah: skorSalah };
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dataKuis) })
            .then(() => console.log("Data tersimpan di server")).catch(e => console.error('Error!', e));

            // Tombol Bonus eBook
            const learnBtn = document.createElement("button");
            learnBtn.textContent = "üìñ Bonus e-Book Ramadhan";
            learnBtn.onclick = () => window.location.href = 'https://drive.google.com/file/d/1hWKJqHEpmtaPVIaIVBsbU_2iFRCKIZS6/view';
            Object.assign(learnBtn.style, { fontSize: "16px", padding: "12px 20px", marginTop: "30px", border: "none", borderRadius: "50px", background: "linear-gradient(135deg, #F5D061, #e6b12c)", color: "#1a2a26", cursor: "pointer", fontWeight: "bold", transition: "0.3s", boxShadow: "0 4px 15px rgba(245, 208, 97, 0.4)" });
            learnBtn.onmouseover = () => learnBtn.style.transform = "scale(1.05)";
            learnBtn.onmouseout = () => learnBtn.style.transform = "scale(1)";
            document.getElementById("gameArea").appendChild(learnBtn);
        }

        // --- EVENT MULAI ---
        document.getElementById("startButton").addEventListener("click", () => {
             namaUser = document.getElementById("namaPeserta").value;
             if (namaUser.trim() === "") { alert("Mohon isi nama Anda sebelum mulai!"); return; }

             skorBenar = 0; skorSalah = 0; nomorSoal = 0; soalSudahDitampilkan.clear(); 
             isGameOverSoundPlayed = false; timeLeft = 420; 
             playSound('start');
             mulaiPermainan();
        });
    </script>
</body>
</html>