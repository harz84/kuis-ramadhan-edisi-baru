<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kuis Ngabuburit Ramadhan 1447 H</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.12.2/lottie.min.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        
        html, body { 
            height: 100%; margin: 0; padding: 0; 
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
        }

        /* --- BACKGROUND & PERBAIKAN LAYAR HP --- */
        body {
            display: flex; justify-content: center; align-items: flex-start; 
            min-height: 100vh;
            padding: 80px 15px 40px 15px; /* Menambah ruang atas agar tidak tertutup timer melayang */
            background: linear-gradient(-45deg, #0f3e33, #155d4c, #0a2e3f, #1f2b38);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            color: #ffffff;
            overflow-y: auto; 
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* --- GLASSMORPHISM GAME AREA --- */
        #gameArea {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px; 
            padding: 40px 20px 60px 20px; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); 
            text-align: center; 
            max-width: 800px; 
            width: 100%; 
            position: relative;
            margin: auto; 
        }

        /* --- TIMER MELAYANG (FLOATING) --- */
        #timerContainer { 
            position: fixed; /* Membuatnya selalu menempel di layar */
            top: 15px; 
            left: 50%; 
            transform: translateX(-50%); /* Menempatkannya tepat di tengah */
            z-index: 1200; /* Selalu di lapisan paling atas */
            display: none; 
            justify-content: center; 
            align-items: center; 
            background: rgba(0, 0, 0, 0.75); /* Sedikit gelap agar kontras dengan soal */
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 50px;
            padding: 8px 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }
        #timerIcon { width: 28px; height: 28px; margin-right: 10px; filter: brightness(0) invert(1); }
        #timer { font-size: 28px; font-weight: 700; color: #fff; letter-spacing: 2px; margin: 0; line-height: 1; }
        
        .pulse-danger { animation: pulseRed 1s infinite; color: #ff6b6b !important; }
        @keyframes pulseRed { 0% { transform: scale(1); } 50% { transform: scale(1.1); text-shadow: 0 0 10px red; } 100% { transform: scale(1); } }

        /* --- TYPOGRAPHY --- */
        #judulGame { 
            font-size: 36px; color: #F5D061; margin-bottom: 15px; font-weight: 700; 
            text-shadow: 2px 2px 8px rgba(0,0,0,0.4); 
            line-height: 1.3;
        }
        #petunjuk { font-size: 18px; margin-bottom: 25px; line-height: 1.6; font-weight: 400; color: #eef; }

        /* --- ANIMASI TRANSISI SOAL --- */
        .fade-in-up { animation: fadeInUp 0.6s ease forwards; }
        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- TOMBOL PILIHAN GANDA (MODERN) --- */
        #pilihanGanda { display: flex; flex-direction: column; gap: 12px; margin-bottom: 10px; }
        #pilihanGanda button {
            font-family: 'Poppins', sans-serif; 
            font-size: 15px; 
            padding: 15px 20px; 
            border: 1px solid rgba(255, 255, 255, 0.3); 
            border-radius: 12px; 
            background: rgba(255, 255, 255, 0.85); 
            color: #1a2a26; 
            cursor: pointer; 
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            text-align: left; 
            line-height: 1.4;
            font-weight: 600;
        }
        #pilihanGanda button:hover { 
            background: #ffffff; 
            transform: translateY(-3px) scale(1.02); 
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2); 
        }
        #pilihanGanda button.salah { background-color: #ff6b6b !important; color: white; animation: shake 0.5s; border: none; }
        #pilihanGanda button.benar { background-color: #51cf66 !important; color: white; border: none; }

        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

        /* --- INPUT & TOMBOL MULAI --- */
        #namaPeserta {
            padding: 15px; margin-bottom: 25px; font-size: 16px; border-radius: 12px; 
            border: 2px solid transparent; width: 85%; max-width: 320px; text-align: center;
            background: rgba(255,255,255,0.9); font-family: 'Poppins', sans-serif;
            outline: none; transition: 0.3s;
        }
        #namaPeserta:focus { border: 2px solid #F5D061; box-shadow: 0 0 15px rgba(245, 208, 97, 0.5); background: #ffffff; }
        
        #startButton { 
            font-size: 18px; padding: 14px 35px; border: none; border-radius: 50px; 
            background: linear-gradient(135deg, #F5D061, #e6b12c); color: #1a2a26; 
            cursor: pointer; font-weight: bold; transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(245, 208, 97, 0.4); text-transform: uppercase; letter-spacing: 1px;
        }
        #startButton:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(245, 208, 97, 0.6); }

        /* TEKS BISMILLAH DIPERBESAR */
        #bismillah { font-size: 40px; color: rgba(255,255,255,0.8); margin-top: 15px; font-style: normal; font-weight: normal;}
        
        #hasil { font-size: 22px; margin-top: 15px; font-weight: bold; min-height: 33px; text-shadow: 1px 1px 3px rgba(0,0,0,0.5); }
        
        #skor { position: absolute; bottom: 20px; right: 0; left: 0; font-size: 16px; font-weight: bold; color: rgba(255,255,255,0.8); text-align: center;}
        #skorBenar { color: #51cf66; }
        #skorSalah { color: #ff6b6b; }

        #copyright { position: fixed; bottom: 10px; right: 15px; font-size: 12px; color: rgba(255,255,255,0.5); z-index: 1100; }

        /* POSISI ANIMASI DI SAMPING KANAN TEKS JUDUL SOAL */
        #correctAnimation, #wrongAnimation { 
            position: absolute; 
            left: 100%; 
            top: 50%; 
            transform: translateY(-50%); 
            margin-left: 12px; 
            width: 50px; 
            height: 50px; 
            display: none; 
            z-index: 1050; 
            pointer-events: none; 
        }

        /* RESPONSIVE UNTUK HP */
        @media (max-width: 768px) {
            body { padding: 70px 10px 20px 10px; } /* Jarak atas ditambah agar timer tidak menutupi kuis */
            #judulGame { font-size: 26px; }
            #petunjuk { font-size: 15px; }
            #pilihanGanda button { font-size: 14px; padding: 12px 15px; }
            #gameArea { padding: 30px 15px 50px 15px; }
            #correctAnimation, #wrongAnimation { width: 45px; height: 45px; margin-left: 8px; }
            
            /* Penyesuaian Timer untuk HP */
            #timerContainer { top: 10px; padding: 6px 15px; }
            #timer { font-size: 22px; }
            #timerIcon { width: 20px; height: 20px; }
        }
    </style>
</head>
<body>
    <div id="timerContainer" style="display: none;">
        <img id="timerIcon" src="https://img.icons8.com/ios-filled/50/ffffff/hourglass.png" alt="Hourglass">
        <span id="timer">05:00</span>
    </div>

    <div id="gameArea">
        <div id="startScreen" class="fade-in-up">
            <h1 id="judulGame">Kuis Ngabuburit<br>Ramadhan 1447 H</h1>
            <p id="petunjuk" style="font-size: 16px;">Uji pengetahuan Islam kamu sambil menunggu waktu berbuka puasa!</p>
            
            <input type="text" id="namaPeserta" placeholder="Ketik Nama Anda Di Sini"><br>
            <button id="startButton">Mulai Kuis</button>
            <p id="bismillah">Ô∑Ω</p>
        </div>

        <div id="judulSoalWrapper" class="fade-in-up" style="display: none; text-align: center; margin-bottom: 15px;">
            <div style="display: inline-flex; align-items: center; position: relative;">
                <h1 id="judulGameAktif" style="font-size: 20px; color: #F5D061; margin: 0;"></h1>
                <div id="correctAnimation"></div>
                <div id="wrongAnimation"></div>
            </div>
        </div>

        <p id="petunjukSoal" class="fade-in-up" style="display: none;"></p>
        
        <div id="pilihanGanda" class="fade-in-up" style="display: none;">
            </div>
        
        <p id="hasil"></p>
        
        <div id="skor" style="display: none;">
            ‚úÖ Benar: <span id="skorBenar">0</span> &nbsp;|&nbsp; ‚ùå Salah: <span id="skorSalah">0</span>
        </div>
    </div>
    
    <div id="copyright">¬© Mas Har 2026</div>

    <script>
        // --- SOAL TERBARU ---
        const dataTebakan = [
            { 
                deskripsi: "Bagaimana hukum asal seorang wanita melakukan i'tikaf di masjid pada sepuluh hari terakhir bulan Ramadhan?", 
                jawaban: "Diperbolehkan asalkan aman dari fitnah (seperti ada area khusus wanita) dan mendapatkan izin dari suami atau walinya", 
                pilihan: ["Dilarang secara mutlak karena tempat beribadah terbaik bagi wanita adalah di relung rumahnya", "Makruh karena berpotensi mengundang fitnah bagi jamaah laki-laki", "Wajib kifayah sebagaimana diwajibkan bagi kaum laki-laki", "Diperbolehkan asalkan aman dari fitnah (seperti ada area khusus wanita) dan mendapatkan izin dari suami atau walinya"] 
            },
            { 
                deskripsi: "Bolehkah seorang muslim menggabungkan niat puasa Qadha Ramadhan dan puasa sunnah enam hari di bulan Syawal dalam satu hari pelaksanaan puasa (satu niat ganda) untuk mendapatkan dua pahala sekaligus?", 
                jawaban: "Tidak boleh, karena keduanya adalah ibadah yang masing-masing berdiri sendiri (maqshudah lidzatiha) dan qadha adalah kewajiban yang harus dituntaskan tersendiri", 
                pilihan: ["Boleh secara mutlak berdasarkan kaidah tadaakhulul ibadaat (penggabungan ibadah yang sejenis)", "Boleh jika dilakukan secara spesifik pada hari Senin atau Kamis", "Tidak boleh, karena keduanya adalah ibadah yang masing-masing berdiri sendiri (maqshudah lidzatiha) dan qadha adalah kewajiban yang harus dituntaskan tersendiri", "Makruh namun puasanya tetap dinilai sah sebagai bagian dari puasa Syawal"] 
            },
            { 
                deskripsi: "Seseorang mencabut gigi di siang hari Ramadhan dan dokter memberikan suntikan bius lokal (anestesi gusi) kepadanya agar tidak merasa sakit. Apakah suntikan bius tersebut membatalkan puasanya?", 
                jawaban: "Tidak membatalkan puasa karena suntikan bius bukanlah cairan pengganti nutrisi/makanan, dan tidak masuk ke lambung", 
                pilihan: ["Membatalkan puasa karena cairan obat disuntikkan masuk ke dalam aliran darah", "Membatalkan puasa karena rasa sakit yang hilang digantikan oleh cairan bius", "Tidak membatalkan puasa karena suntikan bius bukanlah cairan pengganti nutrisi/makanan, dan tidak masuk ke lambung", "Makruh karena berisiko menelan darah yang keluar dari gusi"] 
            },
            { 
                deskripsi: "Bagaimana hukum orang yang berpuasa mandi dengan cara mengguyur kepala, berendam di air dingin, atau mendinginkan kepalanya dengan kain basah di siang hari Ramadhan karena cuaca yang sangat terik?", 
                jawaban: "Mubah (diperbolehkan) berdasarkan riwayat perbuatan Nabi shallallahu 'alaihi wa sallam dan sahabat Ibnu Umar", 
                pilihan: ["Makruh karena dapat menghilangkan rasa haus yang merupakan bagian dari ujian orang berpuasa", "Haram jika dilakukan secara sengaja setelah tergelincir matahari (waktu Zhuhur)", "Mubah (diperbolehkan) berdasarkan riwayat perbuatan Nabi shallallahu 'alaihi wa sallam dan sahabat Ibnu Umar", "Membatalkan puasa jika hawa dinginnya meresap terasa ke dalam tubuh"] 
            },
            { 
                deskripsi: "Seorang wanita yang sedang berpuasa mendapati darah haid keluar lima menit sebelum azan Maghrib berkumandang. Bagaimana status puasanya pada hari tersebut menurut ijma' para ulama?", 
                jawaban: "Puasanya batal dan ia wajib mengqadha puasa hari itu di luar Ramadhan", 
                pilihan: ["Puasanya tetap sah karena darah keluar sudah sangat mendekati waktu berbuka", "Puasanya sah namun pahalanya berkurang setengahnya", "Puasanya batal dan ia wajib mengqadha puasa hari itu di luar Ramadhan", "Puasanya batal namun ia diampuni dan tidak perlu mengqadha karena bukan unsur kesengajaan"] 
            },
            { 
                deskripsi: "Jika seseorang diwajibkan membayar Fidyah, lalu ia menunaikannya dengan cara mengundang beberapa orang miskin untuk makan malam makanan matang di rumahnya sampai mereka kenyang. Apakah cara ini sah berdasarkan perbuatan sahabat Anas bin Malik radhiyallahu 'anhu?", 
                jawaban: "Sah, dan ini termasuk cara yang diperbolehkan dalam menunaikan fidyah", 
                pilihan: ["Tidak sah, karena fidyah wajib dibagikan murni dalam bentuk beras/biji-bijian yang mentah", "Sah, dan ini termasuk cara yang diperbolehkan dalam menunaikan fidyah", "Sah asalkan ditambah dengan pemberian uang tunai sebagai lauk-pauk", "Makruh, karena makanan matang tidak bisa disimpan lama oleh fakir miskin"] 
            },
            { 
                deskripsi: "Apakah melakukan donor darah (mengeluarkan darah dalam jumlah yang cukup banyak) membatalkan puasa seseorang menurut qiyas (analogi) yang dikuatkan oleh Syaikh Ibnu Utsaimin?", 
                jawaban: "Membatalkan puasa karena diqiyaskan dengan hukum bekam yang menguras tenaga dan melemahkan tubuh", 
                pilihan: ["Tidak membatalkan karena darah dikeluarkan dari tubuh, bukan dimasukkan ke dalam tubuh", "Boleh dan justru dianjurkan karena berniat menolong nyawa orang lain", "Makruh tahrim namun puasanya tetap dinilai sah", "Membatalkan puasa karena diqiyaskan dengan hukum bekam yang menguras tenaga dan melemahkan tubuh"] 
            },
            { 
                deskripsi: "Seorang musafir yang sedang tidak berpuasa (mengambil rukhshah safar) tiba di kampung halamannya dalam keadaan mukim pada pukul 10 pagi di bulan Ramadhan. Apakah ia diwajibkan menahan diri dari makan dan minum (imsak) hingga Maghrib pada hari itu menurut pendapat yang dikuatkan oleh Syaikh Ibnu Utsaimin?", 
                jawaban: "Tidak wajib menahan diri (boleh makan/minum sembunyi-sembunyi) namun tetap wajib mengqadha di hari lain", 
                pilihan: ["Wajib menahan diri hingga Maghrib dan puasanya dihitung sah pada hari itu", "Wajib menahan diri hingga Maghrib namun tetap wajib mengqadha di hari lain", "Tidak wajib menahan diri (boleh makan/minum sembunyi-sembunyi) namun tetap wajib mengqadha di hari lain", "Makruh jika ia makan/minum, dan jika ia puasa maka puasanya sah"] 
            },
            { 
                deskripsi: "Salah satu sunnah berpuasa adalah menyegerakan berbuka (Ta'jil). Kapan waktu yang tepat untuk segera membatalkan puasa menurut Sunnah Nabi shallallahu 'alaihi wa sallam?", 
                jawaban: "Sesaat setelah terbenamnya bulatan matahari secara sempurna meskipun muadzin belum selesai azan Maghrib", 
                pilihan: ["Saat azan Isya berkumandang", "Sesaat setelah terbenamnya bulatan matahari secara sempurna meskipun muadzin belum selesai azan Maghrib", "Menunggu sampai langit benar-benar menjadi gelap dan bintang bermunculan", "Menunggu jamaah berkumpul di masjid terlebih dahulu"] 
            },
            { 
                deskripsi: "Bagaimana hukum mencicipi masakan bagi orang yang sedang memasak untuk berbuka puasa, dengan syarat tidak ada bagian makanan yang ditelan (langsung diludahkan kembali) berdasarkan atsar Ibnu Abbas?", 
                jawaban: "Boleh (mubah) dan puasanya tetap sah karena ada kebutuhan", 
                pilihan: ["Haram dan membatalkan puasa", "Makruh dan mengurangi kesempurnaan pahala puasa", "Boleh (mubah) dan puasanya tetap sah karena ada kebutuhan", "Sunnah bagi ibu rumah tangga"] 
            },
            { 
                deskripsi: "Perbedaan waktu niat antara puasa wajib (seperti Ramadhan) dan puasa sunnah menurut hadits Aisyah radhiyallahu 'anhaadalah...", 
                jawaban: "Puasa wajib harus diniatkan di malam hari, sedangkan puasa sunnah boleh diniatkan di pagi hari (selama belum makan/minum)", 
                pilihan: ["Keduanya wajib diniatkan pada malam hari sebelum Subuh", "Puasa wajib harus diniatkan di malam hari, sedangkan puasa sunnah boleh diniatkan di pagi hari (selama belum makan/minum)", "Keduanya boleh diniatkan pada siang hari asalkan belum masuk waktu Zuhur", "Puasa sunnah harus diniatkan sebulan penuh di awal bulan"] 
            },
            { 
                deskripsi: "Sepasang suami istri berhubungan di malam Ramadhan, lalu mereka tertidur lelap dan baru terbangun setelah azan Subuh berkumandang dalam keadaan belum mandi junub. Apa hukum puasa mereka pada hari itu berdasarkan hadits Aisyah dan Ummu Salamah?", 
                jawaban: "Sah, mereka berdua cukup mandi junub lalu shalat Subuh dan melanjutkan puasa", 
                pilihan: ["Puasanya batal dan mereka wajib qadha", "Sah, mereka berdua cukup mandi junub lalu shalat Subuh dan melanjutkan puasa", "Batal karena syarat puasa adalah harus suci dari hadats besar semenjak sebelum fajar", "Sah, namun mereka diwajibkan membayar fidyah"] 
            },
            { 
                deskripsi: "Sesuai dengan urutan sunnah Nabi shallallahu 'alaihi wa sallam yang diriwayatkan dari Anas bin Malik radhiyallahu 'anhu, makanan atau minuman apa yang paling utama (afdhal) didahulukan untuk membatalkan puasa?", 
                jawaban: "Kurma basah (ruthab), jika tidak ada maka kurma kering (tamr), jika tidak ada maka tegukan air putih", 
                pilihan: ["Kurma kering (tamr), lalu kurma basah (ruthab), lalu air putih", "Air zam-zam, lalu susu murni, lalu kurma kering (tamr)", "Kurma basah (ruthab), jika tidak ada maka kurma kering (tamr), jika tidak ada maka tegukan air putih", "Makanan atau minuman apa saja yang manis rasanya"] 
            },
            { 
                deskripsi: "Di masyarakat kita sering dikenal istilah waktu \"Imsak\" (biasanya 10 menit sebelum azan Subuh). Kapankah batas akhir yang sesungguhnya bagi seseorang untuk berhenti makan dan minum sahur menurut nash Al-Qur'an dan Sunnah?", 
                jawaban: "Saat terbitnya fajar shadiq, yang di masa kini ditandai dengan berkumandangnya azan shalat Subuh yang tepat waktu", 
                pilihan: ["Saat sirine atau jadwal Imsak tersebut tiba, sebagai bentuk kehati-hatian yang diwajibkan", "Saat terbitnya fajar shadiq, yang di masa kini ditandai dengan berkumandangnya azan shalat Subuh yang tepat waktu", "Saat azan Subuh benar-benar telah selesai dikumandangkan oleh muadzin", "Saat langit mulai terlihat terang benderang dan matahari bersiap terbit"] 
            },
            { 
                deskripsi: "Bagaimana hukum seorang suami mencium istrinya di siang hari bulan Ramadhan menurut sunnah yang dicontohkan oleh Rasulullah shallallahu 'alaihi wa sallam dan penjelasan Aisyah radhiyallahu 'anha?", 
                jawaban: "Diperbolehkan bagi orang yang mampu menahan syahwatnya, namun terlarang/makruh bagi yang khawatir hal itu akan memancingnya kepada jima' (hubungan intim)", 
                pilihan: ["Batal puasanya secara mutlak dan ia wajib membayar kaffarah (denda)", "Haram dan berdosa, meskipun puasanya tetap dinilai sah", "Makruh tahrim bagi semua kalangan, baik pemuda maupun orang tua tanpa pengecualian", "Diperbolehkan bagi orang yang mampu menahan syahwatnya, namun terlarang/makruh bagi yang khawatir hal itu akan memancingnya kepada jima' (hubungan intim)"] 
            }
        ];

        // --- Variabel Global ---
        let soalSaatIni; let jawabanBenar = false; let skorBenar = 0; let skorSalah = 0; 
        let soalSudahDitampilkan = new Set(); let nomorSoal = 0; const totalSoal = 15; 
        let timerInterval = null; let timeLeft = 300; // 5 menit
        let isGameOverSoundPlayed = false; let namaUser = "";

        // --- Audio Sederhana ---
        function playSound(type) {
            let src = '';
            if(type === 'start') src = 'ping.wav';
            else if(type === 'success') src = 'success.wav';
            else if(type === 'fail') src = 'gameovertwew.wav';
            else src = type; 
            
            if(src) {
                let audio = new Audio(src);
                audio.play().catch(e => console.log("Audio play prevented:", e));
            }
        }

        function updateTimer() { 
            let minutes = Math.floor(timeLeft / 60); 
            let seconds = timeLeft % 60; 
            const timerEl = document.getElementById("timer");
            timerEl.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`; 
            
            if(timeLeft <= 30) timerEl.classList.add("pulse-danger");
            else timerEl.classList.remove("pulse-danger");

            if (timeLeft <= 0) { 
                clearInterval(timerInterval); timerInterval = null; 
                if (nomorSoal < totalSoal) { skorSalah += (totalSoal - nomorSoal); } 
                akhirPermainan(); 
            } else { 
                timeLeft--; 
            } 
        }

        function triggerAnimation(elementId) {
            const el = document.getElementById(elementId);
            el.classList.remove("fade-in-up");
            void el.offsetWidth; // trigger reflow
            el.classList.add("fade-in-up");
        }

        function playLottieAnimation(type) { 
            const container = document.getElementById(type === 'correct' ? 'correctAnimation' : 'wrongAnimation');
            container.style.display = 'block'; container.innerHTML = ''; 
            try { 
                lottie.loadAnimation({ container: container, renderer: 'svg', loop: false, autoplay: true, path: type === 'correct' ? 'correctan.json' : 'wrong.json' }); 
            } catch (e) {} 
            setTimeout(() => { container.style.display = 'none'; }, 2000); 
        }

        function mulaiPermainan() {
            document.getElementById("startScreen").style.display = "none";
            document.getElementById("timerContainer").style.display = "flex"; // Timer dimunculkan dengan flex
            
            const judulSoalWrapper = document.getElementById("judulSoalWrapper");
            const judulGameAktif = document.getElementById("judulGameAktif");
            const petunjukSoal = document.getElementById("petunjukSoal");
            const pilihanGanda = document.getElementById("pilihanGanda");
            
            judulSoalWrapper.style.display = "block";
            petunjukSoal.style.display = "block";
            pilihanGanda.style.display = "flex";
            document.getElementById("skor").style.display = "block";

            if (!timerInterval && timeLeft > 0) { updateTimer(); timerInterval = setInterval(updateTimer, 1000); }

            jawabanBenar = false;
            let soalTersedia = dataTebakan.filter(soal => !soalSudahDitampilkan.has(soal.deskripsi));

            if (soalTersedia.length === 0 || nomorSoal >= totalSoal) { 
                akhirPermainan(); return; 
            }

            nomorSoal++;
            soalSaatIni = soalTersedia[Math.floor(Math.random() * soalTersedia.length)];
            soalSudahDitampilkan.add(soalSaatIni.deskripsi);

            judulGameAktif.textContent = `Soal ${nomorSoal} dari ${totalSoal}`;
            petunjukSoal.textContent = soalSaatIni.deskripsi;
            
            triggerAnimation("judulSoalWrapper");
            triggerAnimation("petunjukSoal");
            triggerAnimation("pilihanGanda");

            pilihanGanda.innerHTML = '';
            const shuffledPilihan = [...soalSaatIni.pilihan].sort(() => Math.random() - 0.5);

            shuffledPilihan.forEach(pilihanText => {
                const button = document.createElement("button"); 
                button.textContent = pilihanText;
                button.onclick = function() { 
                    if (!jawabanBenar && timeLeft > 0) cekJawaban(pilihanText, button); 
                };
                pilihanGanda.appendChild(button);
            });

            document.getElementById("hasil").textContent = ""; 
            document.getElementById("skorBenar").textContent = skorBenar; 
            document.getElementById("skorSalah").textContent = skorSalah;
        }

        function cekJawaban(jawabanYangDipilih, buttonElement) {
            const pilihanButtons = document.querySelectorAll("#pilihanGanda button"); 
            pilihanButtons.forEach(btn => btn.style.pointerEvents = 'none'); 
            
            if (jawabanYangDipilih === soalSaatIni.jawaban) {
                document.getElementById("hasil").textContent = "‚ú® Jawaban Benar!"; 
                document.getElementById("hasil").style.color = "#51cf66";
                playLottieAnimation('correct'); playSound('success'); 
                jawabanBenar = true; skorBenar++;
                buttonElement.classList.add("benar");
            } else {
                document.getElementById("hasil").textContent = "‚ùå Jawaban Salah!"; 
                document.getElementById("hasil").style.color = "#ff6b6b";
                playLottieAnimation('wrong'); playSound('fail'); 
                skorSalah++;
                buttonElement.classList.add("salah");
                
                pilihanButtons.forEach(btn => { 
                    if (btn.textContent === soalSaatIni.jawaban) btn.classList.add("benar"); 
                });
            }
            
            document.getElementById("skorBenar").textContent = skorBenar;
            document.getElementById("skorSalah").textContent = skorSalah;

            setTimeout(() => { 
                if (nomorSoal < totalSoal && timeLeft > 0) mulaiPermainan(); 
                else akhirPermainan(); 
            }, 2000);
        }

        function akhirPermainan() {
            if (timerInterval) { clearInterval(timerInterval); timerInterval = null; }
            if (isGameOverSoundPlayed) return;

            const skorAkhir = totalSoal > 0 ? (skorBenar / totalSoal) * 100 : 0;
            let warnaSkor, komentar, gameOverSoundFile;

            if (skorAkhir < 50) { gameOverSoundFile = 'ast.mp3'; komentar = "Belajar lagi ya.... üòäüìö"; warnaSkor = "#ff6b6b"; }
            else if (skorAkhir <= 84) { gameOverSoundFile = 'alh.mp3'; komentar = "Alhamdulillah, Mantap! üëç"; warnaSkor = "#F5D061"; }
            else { gameOverSoundFile = 'masy.mp3'; komentar = "MasyaAllah, Kamu Luar Biasa! üåüüèÜ"; warnaSkor = "#51cf66"; }

            document.getElementById("judulGameAktif").textContent = "Kuis Selesai!";
            document.getElementById("timerContainer").style.display = "none";
            document.getElementById("skor").style.display = "none";
            document.getElementById("pilihanGanda").style.display = "none";
            document.getElementById("hasil").style.display = "none";

            const petunjuk = document.getElementById("petunjukSoal");
            petunjuk.innerHTML = `
                <div style="font-size: 24px; margin-bottom: 15px;">Alhamdulillah, Terima kasih <b>${namaUser}</b>!</div>
                <div style="font-size: 40px; font-weight: bold; color: ${warnaSkor}; text-shadow: 0 0 10px rgba(0,0,0,0.5); margin: 20px 0;">Nilai: ${skorAkhir.toFixed(0)}</div>
                <div style="font-size: 18px; display: inline-block; text-align: left; background: rgba(0,0,0,0.2); padding: 15px 30px; border-radius: 15px;">
                    ‚úÖ Benar: <b>${skorBenar}</b><br>
                    ‚ùå Salah: <b>${skorSalah}</b>
                </div>
                <div style="margin-top: 20px; font-size: 22px; color: #fff;">${komentar}</div>
            `;
            triggerAnimation("judulSoalWrapper");
            triggerAnimation("petunjukSoal");

            playSound(gameOverSoundFile); isGameOverSoundPlayed = true;

            // --- PENGIRIMAN DATA KE GOOGLE SHEETS ---
            const scriptURL = 'https://script.google.com/macros/s/AKfycbzcZ-6282s8art10zsRbaadJsa-VDQ_HsXtfHIJFmAH-iav481nDn40hFWU_baiJUVREQ/exec'; 
            
            let dataKuis = { waktu: new Date().toLocaleString('id-ID'), nama: namaUser, skor: skorAkhir.toFixed(0), benar: skorBenar, salah: skorSalah };
            fetch(scriptURL, { method: 'POST', mode: 'no-cors', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(dataKuis) })
            .then(() => console.log("Data tersimpan di server")).catch(e => console.error('Error!', e));

            // Tombol Bonus eBook
            const learnBtn = document.createElement("button");
            learnBtn.textContent = "üìñ Bonus e-Book Ramadhan";
            learnBtn.onclick = () => window.location.href = 'https://drive.google.com/file/d/1hWKJqHEpmtaPVIaIVBsbU_2iFRCKIZS6/view';
            Object.assign(learnBtn.style, { fontSize: "16px", padding: "12px 20px", marginTop: "30px", border: "none", borderRadius: "50px", background: "linear-gradient(135deg, #F5D061, #e6b12c)", color: "#1a2a26", cursor: "pointer", fontWeight: "bold", transition: "0.3s", boxShadow: "0 4px 15px rgba(245, 208, 97, 0.4)" });
            learnBtn.onmouseover = () => learnBtn.style.transform = "scale(1.05)";
            learnBtn.onmouseout = () => learnBtn.style.transform = "scale(1)";
            document.getElementById("gameArea").appendChild(learnBtn);
        }

        // --- EVENT MULAI ---
        document.getElementById("startButton").addEventListener("click", () => {
             namaUser = document.getElementById("namaPeserta").value;
             if (namaUser.trim() === "") { alert("Mohon isi nama Anda sebelum mulai!"); return; }

             skorBenar = 0; skorSalah = 0; nomorSoal = 0; soalSudahDitampilkan.clear(); 
             isGameOverSoundPlayed = false; timeLeft = 300; 
             playSound('start');
             mulaiPermainan();
        });
    </script>
</body>
</html>